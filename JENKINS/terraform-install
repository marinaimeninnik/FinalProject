pipeline {
    agent any

       stages {
        stage('Checkout') {
            steps {
                checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/marinaimeninnik/FinalProject.git']])
            }
        }
        
        stage('installing wget'){
            steps{
                sh ('apt-get install -y wget')
            }
        }
        
        stage('terraform installing'){
            steps{
                sh ('apt update && apt install gpg')
            }
        }
        
        stage('Download the signing key to a new keyring'){
           steps{
               sh ('wget -O- https://apt.releases.hashicorp.com/gpg | gpg --dearmor | tee /usr/share/keyrings/hashicorp-archive-keyring.gpg')
           }
        }
        
        stage("Verify the key's fingerprint"){
            steps{
                sh ('gpg --no-default-keyring --keyring /usr/share/keyrings/hashicorp-archive-keyring.gpg --fingerprint')
            }
        }
        
        stage('Add the HashiCorp repo'){
            steps{
                sh ('echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | tee /etc/apt/sources.list.d/hashicorp.list')
            }
        }
        
        stage('apt update'){
            steps{
                sh('apt update')
            }
        }
        
        stage('install terraform'){
            steps{
                sh('apt install terraform')
            }
        }
    }
}